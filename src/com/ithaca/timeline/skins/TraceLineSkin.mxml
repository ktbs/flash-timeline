<?xml version="1.0" encoding="utf-8"?>
<s:Skin xmlns:fx="http://ns.adobe.com/mxml/2009"
		xmlns:s="library://ns.adobe.com/flex/spark"
		xmlns:tl="com.ithaca.timeline.*"
		xmlns:mx="library://ns.adobe.com/flex/mx"
		xmlns:Skins="com.ithaca.timeline.skins.*"
		creationComplete="creationCompleteHandler(event)"
		width="100%"
		height="100%">

	<fx:Metadata>[HostComponent("com.ithaca.timeline.TraceLine")]</fx:Metadata>

	<fx:Declarations>
		<fx:XML id="menuContent">
			<root>
				<menuitem label="Ajouter une traceline"
						  eventName="newTraceLine" />
				<menuitem type="separator" />
				<menuitem label="Modifier cette traceline"
						  eventName="editTraceLine" />
				<menuitem label="Supprimer cette traceline"
						  eventName="removeTraceLine" />
			</root>
		</fx:XML>
	</fx:Declarations>

	<fx:Script>
		<![CDATA[
			import com.ithaca.timeline.events.TimelineEvent;
			import com.ithaca.timeline.LayoutNode;
			import com.ithaca.timeline.ObselsRenderer;
			import com.ithaca.timeline.SelectorRegexp;
			import com.ithaca.timeline.Timeline;
			import com.ithaca.timeline.TraceLine;
			import com.ithaca.timeline.TraceLineGroup;
			import com.ithaca.timeline.ZoomContext;
			import com.ithaca.traces.Obsel;
			import flash.display.DisplayObject;
			import flash.display.Graphics;
			import flash.display.Shape;
			import flash.display.Sprite;
			import flash.events.Event;
			import flash.events.MouseEvent;
			import flash.geom.Point;
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.controls.Menu;
			import mx.core.UIComponent;
			import mx.events.CollectionEvent;
			import mx.events.FlexEvent;
			import mx.events.MenuEvent;
			import mx.managers.PopUpManager;
			
			[Bindable]
			public var forme:Shape = new Shape();
			
			[Bindable]
			public var displayLevel:Number = 0;
			[Bindable]
			public var timeline:Timeline;
			
			[Bindable]
			public var simpleObselsRenderer:ObselsRenderer;
			
			private var editMenu:Menu;
			
			protected function creationCompleteHandler(event:FlexEvent):void
			{
				simpleObselsRenderer = new ObselsRenderer(hostComponent._timeline.zoomContext.cursorRange, hostComponent._timeline);
				simpleObselsRenderer.height = hostComponent.getStyle("rendererHeight") as Number;
				simpleObselsRenderer.percentWidth = 100;
				simpleObselsRenderer.obselsCollection = hostComponent._obsels;
				simpleObselsRenderer.addEventListener(MouseEvent.CLICK, onSelect);
				hostComponent._timeline.zoomContext.addEventListener(TimelineEvent.TIMERANGES_CHANGE, simpleObselsRenderer.onTimerangeChange);
				rendererGroup.addElement(simpleObselsRenderer);
				timeline = hostComponent._timeline;
			}
			
			protected function onSelect(event:Event):void
			{
				parentApplication.dg_label.text = hostComponent.title + " : " + hostComponent._obsels.length + " obsels";
				parentApplication.obselList_dg.dataProvider = hostComponent._obsels;
			}
		]]>
	</fx:Script>

	<s:states>
		<s:State name="normal" />
		<s:State name="open" />
		<s:State name="disabled" />
	</s:states>

	<s:VGroup width="100%" gap="5">
		<s:Group id="rendererGroup"  width="100%" height="100%" />
		<s:VGroup id="contentGroup"  includeIn="open"   width="100%" gap="5" />
	</s:VGroup>
</s:Skin>
